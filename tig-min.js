(function(){var $,TigAttribute,TigBlock,TigCondition,TigContent,TigDefine,TigEvaluator,TigLocalDataCleaner,TigOmit,TigRepeat,TigReplace,constants,parse,register,sortTigs,sortedTigs,sortedTigsIsDirty,tigResolve,tigs,__bind=function(a,b){return function(){return a.apply(b,arguments)}};$=jQuery,$.fn.extend({tig:function(a,b){return parse(this,a,b),this}}),$.extend({tigRegister:function(a,b){return register(a,b),this},tigConstants:function(){return constants}}),constants={PREPROCESSING_COMPLETE:-100,PROCESSING_BEGIN:0,HTML_COMPLIANCE:100,TIG_DEFINE:200,TIG_CONDITION:300,TIG_REPEAT:400,TIG_CONTENT:500,TIG_REPLACE:600,TIG_ATTRIBUTES:700,TIG_OMIT:800,TIG_BLOCK:900,TIG_CLEANUP:1e3,PROCESSING_COMPLETE:1100},tigs=[],sortedTigs=[],sortedTigsIsDirty=!0,tigResolve=function(a,b,c){var d,e,f,g,h,i;c==null&&(c=null),f=a.split("/"),g=b,d=!1;for(h=0,i=f.length;h<i;h++){e=f[h];if(g[e]!=null)g=g[e];else{d=!0;break}}return d?c:g},sortTigs=function(){var a,b,c,d,e,f,g,h,i,j,k,l;e={},c=[],d={};for(f=0,i=tigs.length;f<i;f++)a=tigs[f],e[a.weight]==null&&(e[a.weight]=[]),e[a.weight].push(a),d[a.weight]==null&&(d[a.weight]=!0,c.push(a.weight));c.sort(function(a,b){return a-b});for(g=0,j=c.length;g<j;g++){b=c[g],l=e[b];for(h=0,k=l.length;h<k;h++)a=l[h],sortedTigs.push(a.item)}return sortedTigsIsDirty=!1},parse=function(a,b,c){var d,e,f,g,h,i;sortedTigsIsDirty&&sortTigs(),f={},d=new TigEvaluator(b),i=[];for(g=0,h=sortedTigs.length;g<h;g++)e=sortedTigs[g],i.push($(e.searchString(),a).each(function(){return e.onMatch($(this),d)}));return i},register=function(a,b){return tigs.push({item:new a,weight:b})},TigEvaluator=function(){function TigEvaluator(a){this.data=a,this.localData=[],this.globalData={},this.resolveRegex=/#\{(.*?)\}/g,this.andRegex=/[\s+]and[\s+]/gi,this.orRegex=/[\s+]or[\s+]/gi,this.gteRegex=/[\s+]gte[\s+]/gi,this.lteRegex=/[\s+]lte[\s+]/gi,this.ltRegex=/[\s+]lt[\s+]/gi,this.gtRegex=/[\s+]gt[\s+]/gi,this.eqRegex=/[\s+]eq[\s+]/gi,this.exRegex=/[\s+]ex[\s+]/gi,this.structureRegex=/^structure[\s]+/i,this.textRegex=/^text[\s]+/i,this.storageAttr="data-tig-working-localdata"}return TigEvaluator.prototype.store=function(a,b){var c,d;return a===null?($.extend(this.globalData,b),-1):($(a).attr(this.storageAttr)!=null?(c=$(item).attr(this.storageAttr),d=this.localData[c]||{},b=$.extend(d,b),this.localData[c]=b):(c=this.localData.length,this.localData.push(b),a.attr(this.storageAttr,c)),c)},TigEvaluator.prototype.evaluate=function(str,node,options){var isStructure,merge,mergedData,originalString,result;options==null&&(options={}),$.extend({to:"null",structure:!1},options),mergedData={},originalString=str,$.extend(mergedData,this.data,this.globalData),$(node).attr(this.storageAttr)!=null&&(merge=this.localData[$(node).attr(this.storageAttr)]||{},$.extend(mergedData,merge)),$(node.parents("*["+this.storageAttr+"]").get().reverse()).each(__bind(function(a,b){return merge=this.localData[$(b).attr(this.storageAttr)]||{},$.extend(mergedData,merge)},this)),isStructure=!1,(str!=null?str.indexOf("structure "):void 0)===0||options.structure?(isStructure=!0,str=str.replace(this.structureRegex,"")):(str!=null?str.indexOf("text "):void 0)===0&&(str=str.replace(this.textRegex,"")),str=str.replace(this.resolveRegex,"tigResolve('$1', mergedData, "+options.to+")").replace(this.andRegex," && ").replace(this.orRegex," || ").replace(this.gteRegex," >= ").replace(this.lteRegex," <= ").replace(this.gtRegex," > ").replace(this.ltRegex," < ").replace(this.eqRegex," == ").replace(this.exRegex," === ");try{result=eval(str)}catch(error){throw new Error("Tig Syntax - the following expression is not valid: "+originalString+" => "+str)}return!isStructure&&result&&(result=$("<div/>").text(result).html()),result},TigEvaluator}(),TigLocalDataCleaner=function(){function a(){this.attr="data-tig-working-localdata"}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){return a.removeAttr(this.attr)},a}(),$.tigRegister(TigLocalDataCleaner,constants.TIG_CLEANUP),TigDefine=function(){function a(){this.attr="data-tig-define",this.splitRegex=/,/,this.phrases=/^[\s]*(.*?)[\s]*=[\s]*(.*)[\s]*$/,this.localRegex=/^local[\s]+/i,this.globalRegex=/^global[\s]+/i}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;c=a.attr(this.attr),g={},e={},j=c.split(this.splitRegex);for(l=0,m=j.length;l<m;l++)i=j[l],i=$.trim(i),f=!1,i.indexOf("local ")===0?(f=!0,i=i.replace(this.localRegex,"")):i.indexOf("global ")===0?i=i.replace(this.globalRegex,""):f=!0,d=i.match(this.phrases),h=d[1],k=b.evaluate(d[2],a),f?g[h]=k:e[h]=k;return b.store(a,g),b.store(null,e),a.removeAttr(this.attr),!0},a}(),$.tigRegister(TigDefine,constants.TIG_DEFINE),TigContent=function(){function a(){this.attr="data-tig-content"}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){var c;return c=a.attr(this.attr),a.removeAttr(this.attr).html(b.evaluate(c,a))},a}(),$.tigRegister(TigContent,constants.TIG_CONTENT),TigReplace=function(){function a(){this.attr="data-tig-replace"}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){var c;return c=a.attr(this.attr),a.before(b.evaluate(c,a)),a.remove()},a}(),$.tigRegister(TigReplace,constants.TIG_REPLACE),TigBlock=function(){function a(){this.attr="data-tig-block"}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){return a.children.each(function(){return a.before(this)}),a.remove()},a}(),$.tigRegister(TigBlock,constants.TIG_BLOCK),TigAttribute=function(){function a(){this.attr="data-tig-attribute",this.splitRegex=/,/,this.phrases=/^[\s]*(.*?)[\s]*(\+?=)[\s]*(.*)[\s]*$/}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){var c,d,e,f,g,h,i,j,k,l;c=a.attr(this.attr),e=c.split(this.splitRegex);for(k=0,l=e.length;k<l;k++)d=e[k],f=d.match(this.phrases),j=$.trim(f[1]),h=f[2],i=b.evaluate(f[3],a),g=a.attr(j),h==="+="&&(i=g+i),a.attr(j,i);return a.removeAttr(this.attr)},a}(),$.tigRegister(TigAttribute,constants.TIG_ATTRIBUTES),TigCondition=function(){function a(){this.attr="data-tig-condition"}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){var c;return c=b.evaluate(a.attr(this.attr),a),c?a.removeAttr(this.attr):a.remove()},a}(),$.tigRegister(TigCondition,constants.TIG_CONDITION),TigOmit=function(){function a(){this.attr="data-tig-omit"}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){var c;return c=b.evaluate(a.attr(this.attr),a),c?a.remove():a.removeAttr(this.attr)},a}(),$.tigRegister(TigOmit,constants.TIG_OMIT),TigRepeat=function(){function a(){this.attr="data-tig-repeat",this.phrases=/^[\s]*(.*?)[\s]*as[\s]*(.*)[\s]*$/}return a.prototype.searchString=function(){return"*["+this.attr+"]"},a.prototype.onMatch=function(a,b){var c,d,e,f,g,h,i,j,k,l;c=a.attr(this.attr),e=c.match(this.phrases),j=b.evaluate(e[1],a,{to:"[]",structure:!0}),g=e[2],a.removeAttr(this.attr),d=0;for(k=0,l=j.length;k<l;k++)f=j[k],h=a.clone(),i={repeat:{index:d,number:d+1,even:d%2!==0,odd:d%2===0,start:0,end:j.length-1,length:j.length}},i[g]=j[d],b.store(h,i),a.parent().append(h),d++;return a.remove()},a}(),$.tigRegister(TigRepeat,constants.TIG_REPEAT)}).call(this)